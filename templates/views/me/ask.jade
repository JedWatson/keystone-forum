extends ../../layouts/default

block content
	.container
		.row
			.col-sm-9
				h4 New question
				hr
				form(method='post', enctype='multipart/form-data', autocomplete='off', novalidate).management-form
					input(type='hidden', name='action', value='topic.create')

					//- category select
					//- .form-group: .btn-group(data-toggle='buttons')
						for category in categories
							.btn.btn-default
								input(type='radio', name='categories', value=category.id, checked=category.id == form.categories)
								=category.name
					
					//- name + content
					.form-group
						input(type='text', name='name', placeholder='Title', value=form.name).form-control.input-lg
					.form-group
						p.help-block Comments are parsed with 
							a(href='http://daringfireball.net/projects/markdown/', target='_blank', title='Markdown Guide (new window)') Markdown
						textarea(name='content.extended', placeholder='', style='min-height: 300px;').form-control.js-wysiwyg!= form['content.extended']
								
					.spotlight-footer
						button(type='submit', data-loading-text='Saving...').btn.btn-primary Ask Question

			.col-sm-3
				h4 Select a Category
				hr
				.categories-list: ul
					for category in categories
						li(class=category.key)
							label.categories-list__item
								input(type='radio', name='categories', value=category.id, checked=category.id == form.categories)
								span(class=category.key).category-indicator
								span= category.name
				hr
				h4.text-muted Asking Tips
				p Is your question about KeystoneJS?
				p We prefer questions that can be answered, not just discussed.
				p Provide details. Share your research.
						
block js
	//- script(src='/js/lib/bootstrap/button.js')
	script.
		$(function() {
			
			var $form = $('.management-form'),
				$submit = $form.find('[type="submit"]');
			
			//- focus + select first form control on load
			$form.find('.form-control').eq(0).focus().select();
			
			//- prevent multiple submits
			$form.submit( function() {
				$submit.button('loading');
			});

			//- select a category
			$('[name="categories"]').each( function() {
				$(this).change( function() {
					var $self = $(this),
						$button = $self.closest('li');

					$button.siblings().removeClass('is-active');

					if ($self.prop('checked', true)) {
						$button.addClass('is-active');
					}
				});
			});
			
		});