extends ../../layouts/default

include ../../mixins/commenting

block content
	.container
		.row
			.col-sm-9
				if current.user
					a(href=watchedByUser ? '?unwatch' : '?watch', title=watchedByUser ? 'Stop email notifications' : 'Get email notifications', rel='tooltip', data-placement='left').btn.btn-sm.btn-default.pull-right
						span.entypo.entypo-eye
						=watchedByUser ? ' Unwatch' : ' Watch'
				h4: a(href='/').text-muted &larr; Back to all questions
				hr
				article.topic-details
					header.topic-details__header
						+flash-messages(messages)
						h1.heading=topic.name
						if topic.category
							a(href='/newest/' + topic.category.key).topic-category
								span(class=topic.category.key).category-indicator
								span= topic.category.name
						if topic.author || topic.publishedAt
							span.subheading
								if topic.publishedAt
									span  started on  
									= topic._.publishedAt.format('dddd, D MMM YYYY')
								if topic.author
									span  by 
									a(href=topic.author.url)= topic.author.name.full
								if replies.length
									|  &middot; 
									a(href='#comments', data-scrollduratio=300).js-scrollto-anchor= plural(replies.length, '* answer', '* answers')
								if current.user && current.user.id == topic.author.id
									|  &middot; 
									a(href='?remove=topic&topic=' + topic.id, title='Delete this topic', rel='tooltip', data-placement='right').topic-delete.js-delete-confirm Delete
					.topic-details__body
						.media
							a(href='/profile/' + topic.author.key).pull-left.media-avatar
								img(src=topic.author.photo.exists ? topic.author._.photo.thumbnail(60,60) : '/images/scaffolding/60x60.png', alt=topic.author.name.full, width=60, height=60).img-avatar
							.media-body.media-body-column
								p.hidden-xs.text-muted
									strong: a(href='/profile/' + topic.author.key)=topic.author.name.full
									if topic.publishedAt
										|  &middot; 
										span=topic._.publishedAt.format('DD MMM YYYY')
								.details-content-wrapper!=topic.content.full.html
					
					//-comments
					#comments(class=newComment ? 'has-new-comment' : null).topic-details__footer
						if replies.length
							h4.text-muted=plural(replies.length, '* answer', '* answers')
							+comment-thread(replies)
						+comment-form()
			.col-sm-3
				h4.text-muted Meta
				hr
				p This topic has #{plural(topic.replyCount, '* reply', '* replies')}
					if topic.replyCount
						| , the most recent was on #{topic._.lastReplyDate.format('DD MMM YYYY')}
				p #{plural(topic.watchedBy, '* person is', '* people are')} watching this topic
				

				//- more-topics from author
				//- if authorTopics.length
					h4.text-muted More from #{topic.author.name.first} is 
					hr
					ul.list-unstyled
						for authorTopic in authorTopics
							li
								a(href=authorTopic.url)=authorTopic.name
								.text-muted: time(datetime=authorTopic.publishedAt)= authorTopic._.publishedAt.format('DD MMM YYYY')
				//- h4.text-muted Found a bug?
				//- hr
				//- p If you're experiencing what appears to be a bug or something that doesn't seem to be working correctly, please 
					a(href='https://github.com/JedWatson/keystone/issues') log&nbsp;an&nbsp;issue
					|  in the Github project

block js
	script(src='/js/lib/bootstrap/tooltip.js')
	script(src='/js/lib/bootstrap/popover.js')
	script(src='/js/ui.js')
	script(src='/js/lib/moment/moment.min.js')
	script.
		jQuery(function($) {

			// init popover

			$("[rel='tooltip']").tooltip();
			$("[data-toggle='popover']").popover();

			$('.js-timeago').each(function() {
				var timeEl = $(this),
					timeData = timeEl.data();
				
				console.log(timeData);
				console.log(moment(timeData).fromNow());
				
				timeEl.text(moment(timeData).fromNow());
			});
			//- moment("20111031", "YYYYMMDD").fromNow();
		});
		